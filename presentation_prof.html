<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>PostgreSQL 기반 C2C DB 프로젝트 - 발표용</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: #111827;
        background: #f3f4f6;
      }

      .layout {
        display: block;
        min-height: 100vh;
      }

      header {
        background: #111827;
        color: #f9fafb;
        padding: 10px 18px 8px;
        position: sticky;
        top: 0;
        z-index: 20;
      }

      .logo {
        font-size: 1.05rem;
        font-weight: 700;
        margin-bottom: 3px;
      }

      .subtitle {
        font-size: 0.82rem;
        color: #9ca3af;
      }

      nav {
        margin-top: 8px;
        font-size: 0.9rem;
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
      }

      nav button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 5px 10px;
        border-radius: 6px;
        border: none;
        background: transparent;
        color: inherit;
        cursor: pointer;
        font-size: 0.88rem;
        white-space: nowrap;
      }

      nav button.active {
        background: linear-gradient(135deg, #4f46e5, #6366f1);
        color: #f9fafb;
      }

      nav button span.tag {
        display: inline-block;
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 999px;
        background: rgba(249, 250, 251, 0.08);
        margin-left: 6px;
      }

      main {
        padding: 18px 26px 40px;
        overflow-y: auto;
      }

      .section {
        display: none;
        max-width: 960px;
        margin: 0 auto;
      }

      .section.active {
        display: block;
      }

      h1 {
        font-size: 1.6rem;
        margin: 4px 0 10px;
      }

      h2 {
        font-size: 1.2rem;
        margin: 20px 0 8px;
      }

      p {
        margin: 4px 0 8px;
        line-height: 1.55;
        font-size: 0.9rem;
      }

      .pill-row {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin: 4px 0 14px;
      }

      .pill {
        font-size: 0.8rem;
        padding: 3px 8px;
        border-radius: 999px;
        background: #e5e7eb;
        color: #111827;
        white-space: nowrap;
      }

      .card {
        background: #ffffff;
        border-radius: 10px;
        padding: 14px 16px;
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.06);
        border: 1px solid #e5e7eb;
        margin: 14px 0;
      }

      .two-column {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
        gap: 14px;
      }

      ul {
        margin: 6px 0 10px 20px;
        padding: 0;
        font-size: 0.9rem;
      }

      li {
        margin-bottom: 4px;
      }

      .label {
        font-size: 0.78rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: #6b7280;
        margin-bottom: 4px;
      }

      .code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        font-size: 0.78rem;
        background: #111827;
        color: #e5e7eb;
        padding: 3px 6px;
        border-radius: 4px;
        display: inline-block;
        margin: 1px 0;
      }

      .svg-wrapper {
        border-radius: 10px;
        background: radial-gradient(circle at top left, #eef2ff, #f9fafb);
        border: 1px solid #e5e7eb;
        padding: 10px;
        overflow: hidden;
      }

      svg {
        width: 100%;
        height: auto;
      }

      .svg-title {
        font-size: 0.8rem;
        font-weight: 600;
        color: #4b5563;
        margin-bottom: 6px;
      }

      .scenario-step {
        display: grid;
        grid-template-columns: 18px 1fr;
        column-gap: 10px;
        margin-bottom: 6px;
      }

      .scenario-step-number {
        width: 18px;
        height: 18px;
        border-radius: 999px;
        background: #4f46e5;
        color: #f9fafb;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        margin-top: 3px;
      }

      .scenario-step-text {
        font-size: 0.88rem;
      }

      @media (max-width: 900px) {
        .two-column {
          grid-template-columns: minmax(0, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div class="layout">
      <header>
        <div class="logo">PostgreSQL 기반 C2C DB 프로젝트</div>
        <div class="subtitle">
          스키마 설계 · 고급 SQL · 트리거를 중심으로 한 데이터베이스 데모
        </div>
        <nav>
          <button class="active" data-target="intro">
            1. 프로젝트 개요
          </button>
          <button data-target="pg">2. PostgreSQL 선택 이유</button>
          <button data-target="schema">3. 핵심 스키마 구조</button>
          <button data-target="scenario-sku">
            4. 시나리오 A: SKU &amp; 통합 검색
          </button>
          <button data-target="scenario-ticket">
            5. 시나리오 B: 티켓 &amp; 암표 방지
          </button>
          <button data-target="scenario-category">
            6. 시나리오 C: 카테고리 필터
          </button>
          <button data-target="scenario-seat">
            7. 시나리오 D: 좌석(JSONB) 필터
          </button>
        </nav>
      </header>

      <main>
        <!-- 1. 프로젝트 개요 -->
        <section id="intro" class="section active">
          <h1>1. 프로젝트 개요</h1>
          <p>
            이 프로젝트는 중고거래(C2C) 서비스를 가정하고,
            <strong>PostgreSQL 기반 데이터베이스 설계와 고급 기능</strong>이
            플랫폼의 품질에 어떤 차이를 만드는지 보여주기 위해 설계되었습니다.
          </p>
          <p>
            특히, 단순한 테이블 나열을 넘어서 다음 네 가지를 핵심 과제로 삼습니다.
          </p>

          <div class="pill-row">
            <span class="pill">SKU 기반 표준 상품 관리</span>
            <span class="pill">티켓 특수화 모델링</span>
            <span class="pill">트리거 기반 암표 방지</span>
            <span class="pill">JSONB · Recursive CTE 활용</span>
          </div>

          <div class="two-column">
            <div class="card">
              <div class="label">기존 C2C 플랫폼의 구조적 한계</div>
              <ul>
                <li>상품 스펙을 전부 문자열로 저장 → 정교한 검색·필터링 한계</li>
                <li>티켓/이벤트 같은 복합 상품을 한 테이블에 혼합 저장</li>
                <li>카테고리 계층을 애플리케이션에서 직접 순회 (N+1 쿼리)</li>
                <li>가격 제한 등 비즈니스 규칙이 DB가 아닌 애플리케이션에만 존재</li>
              </ul>
            </div>

            <div class="card">
              <div class="label">이 프로젝트의 방향</div>
              <ul>
                <li>표준 제품(SKU) 테이블로 상품 표현을 정규화</li>
                <li>티켓 전용 테이블(TicketDetails)로 1:1 특수화 모델링</li>
                <li>JSONB, Recursive CTE, Trigger 등 PostgreSQL 고급 기능 적극 사용</li>
                <li>데이터베이스가 <strong>도메인 규칙을 직접 보장</strong>하는 구조 구현</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- 2. PostgreSQL 선택 이유 -->
        <section id="pg" class="section">
          <h1>2. PostgreSQL 선택 이유</h1>
          <p>
            이 프로젝트에서는 단순 CRUD를 넘어, 데이터베이스가
            <strong>비즈니스 규칙과 복잡한 구조를 직접 책임지는 역할</strong>을
            수행하도록 PostgreSQL을 선택했습니다.
          </p>

          <div class="two-column">
            <div class="card">
              <h2>2-1. JSONB</h2>
              <p>
                표준 상품 스펙과 티켓 좌석 정보를
                <span class="code">JSONB</span>로 저장합니다.
              </p>
              <ul>
                <li>예) <span class="code">{"grade":"R","sector":"A","row":10}</span></li>
                <li>단순 문자열 LIKE 검색이 아닌,
                  <span class="code">seat_info -&gt;&gt; 'sector' = 'A'</span>와 같이 필드 단위 비교 가능</li>
              </ul>
            </div>

            <div class="card">
              <h2>2-2. Recursive CTE</h2>
              <p>
                계층형 카테고리 구조를
                <span class="code">WITH RECURSIVE</span>로 처리합니다.
              </p>
              <ul>
                <li>상위 카테고리를 선택하면 모든 하위 카테고리를 한 번에 조회</li>
                <li>N+1 문제 없이, 단일 SQL로 트리 탐색</li>
              </ul>
            </div>
          </div>

          <div class="two-column">
            <div class="card">
              <h2>2-3. Trigger · PL/pgSQL</h2>
              <p>
                티켓 가격 제한(<span class="code">120%</span>)을 트리거 함수로
                구현합니다.
              </p>
              <ul>
                <li>티켓 원가 대비 120%를 넘는 매물은 INSERT 단계에서 거부</li>
                <li>애플리케이션과 무관하게 DB 자체가 규칙을 강제</li>
              </ul>
            </div>

            <div class="card">
              <h2>2-4. 1:1 특수화 · BIGSERIAL</h2>
              <ul>
                <li>Item ↔ TicketDetails 1:1 특수화로 티켓 전용 속성을 분리</li>
                <li>PK는 BIGSERIAL로 설계하여 서비스 확장에 대비</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- 3. 스키마 구조 -->
        <section id="schema" class="section">
          <h1>3. 핵심 스키마 구조 (요약)</h1>
          <p>
            아래 다이어그램은 실제 데모에서 핵심적으로 활용되는 테이블들의
            관계를 요약한 것입니다.
          </p>

          <div class="card">
            <div class="svg-title">핵심 테이블 관계 (요약 ER 다이어그램)</div>
            <div class="svg-wrapper">
              <svg viewBox="0 0 780 320">
                <!-- Item -->
                <rect
                  x="330"
                  y="120"
                  width="150"
                  height="80"
                  rx="8"
                  fill="#eef2ff"
                  stroke="#4f46e5"
                />
                <text x="405" y="142" text-anchor="middle" font-size="13">
                  Item
                </text>
                <text x="338" y="162" font-size="9">item_id (PK)</text>
                <text x="338" y="176" font-size="9">std_id (FK)</text>
                <text x="338" y="190" font-size="9">category_id (FK)</text>

                <!-- StandardProduct -->
                <rect
                  x="70"
                  y="40"
                  width="190"
                  height="90"
                  rx="8"
                  fill="#ecfdf5"
                  stroke="#16a34a"
                />
                <text x="165" y="62" text-anchor="middle" font-size="13">
                  StandardProduct
                </text>
                <text x="78" y="80" font-size="9">std_id (PK)</text>
                <text x="78" y="94" font-size="9">product_code</text>
                <text x="78" y="108" font-size="9">model_name</text>
                <text x="78" y="122" font-size="9">specs (JSONB)</text>

                <!-- Category -->
                <rect
                  x="70"
                  y="190"
                  width="190"
                  height="80"
                  rx="8"
                  fill="#fef3c7"
                  stroke="#f59e0b"
                />
                <text x="165" y="212" text-anchor="middle" font-size="13">
                  Category
                </text>
                <text x="78" y="230" font-size="9">category_id (PK)</text>
                <text x="78" y="244" font-size="9">parent_category_id (FK)</text>

                <!-- Event -->
                <rect
                  x="540"
                  y="40"
                  width="170"
                  height="70"
                  rx="8"
                  fill="#eff6ff"
                  stroke="#2563eb"
                />
                <text x="625" y="62" text-anchor="middle" font-size="13">
                  Event
                </text>
                <text x="548" y="80" font-size="9">event_id (PK)</text>
                <text x="548" y="94" font-size="9">event_name</text>

                <!-- EventOption -->
                <rect
                  x="540"
                  y="140"
                  width="170"
                  height="80"
                  rx="8"
                  fill="#eff6ff"
                  stroke="#2563eb"
                />
                <text x="625" y="162" text-anchor="middle" font-size="13">
                  EventOption
                </text>
                <text x="548" y="180" font-size="9">event_option_id (PK)</text>
                <text x="548" y="194" font-size="9">event_id (FK → Event)</text>

                <!-- TicketDetails -->
                <rect
                  x="330"
                  y="230"
                  width="190"
                  height="80"
                  rx="8"
                  fill="#fef2f2"
                  stroke="#dc2626"
                />
                <text x="425" y="252" text-anchor="middle" font-size="13">
                  TicketDetails
                </text>
                <text x="338" y="270" font-size="9">item_id (PK &amp; FK → Item)</text>
                <text x="338" y="284" font-size="9">
                  event_option_id (FK → EventOption)
                </text>
                <text x="338" y="298" font-size="9">seat_info (JSONB)</text>

                <!-- Relations -->
                <!-- StandardProduct -> Item -->
                <line
                  x1="260"
                  y1="90"
                  x2="330"
                  y2="150"
                  stroke="#16a34a"
                  stroke-width="1.2"
                  marker-end="url(#arrow)"
                />
                <text x="290" y="100" font-size="9">1 : N</text>

                <!-- Category -> Item -->
                <line
                  x1="260"
                  y1="220"
                  x2="330"
                  y2="180"
                  stroke="#f59e0b"
                  stroke-width="1.2"
                  marker-end="url(#arrow)"
                />
                <text x="290" y="210" font-size="9">1 : N</text>

                <!-- Category self -->
                <path
                  d="M 240 200 C 270 160 270 260 240 240"
                  fill="none"
                  stroke="#f59e0b"
                  stroke-width="1"
                />
                <text x="275" y="205" font-size="9">Hierarchy</text>

                <!-- Event -> EventOption -->
                <line
                  x1="625"
                  y1="110"
                  x2="625"
                  y2="140"
                  stroke="#2563eb"
                  stroke-width="1.2"
                  marker-end="url(#arrow)"
                />
                <text x="633" y="128" font-size="9">1 : N</text>

                <!-- EventOption -> TicketDetails -->
                <line
                  x1="625"
                  y1="220"
                  x2="520"
                  y2="260"
                  stroke="#2563eb"
                  stroke-width="1.2"
                  marker-end="url(#arrow)"
                />
                <text x="575" y="232" font-size="9">1 : N</text>

                <!-- Item -> TicketDetails (1:1) -->
                <line
                  x1="405"
                  y1="200"
                  x2="405"
                  y2="230"
                  stroke="#dc2626"
                  stroke-width="1.2"
                  marker-end="url(#arrow)"
                />
                <text x="413" y="218" font-size="9">1 : 1</text>

                <!-- Arrow marker -->
                <defs>
                  <marker
                    id="arrow"
                    markerWidth="8"
                    markerHeight="8"
                    refX="6"
                    refY="3"
                    orient="auto"
                    markerUnits="strokeWidth"
                  >
                    <path d="M0,0 L0,6 L6,3 z" fill="#4b5563" />
                  </marker>
                </defs>
              </svg>
            </div>
          </div>
        </section>

        <!-- 4. 시나리오 A: SKU & 통합 검색 -->
        <section id="scenario-sku" class="section">
          <h1>4. 시나리오 A: SKU 기반 등록 · 통합 검색</h1>
          <p>
            <strong>목적:</strong> SKU 표준화 테이블과 통합 검색이 실제로 어떻게
            동작하는지 보여줍니다.
          </p>

          <div class="card">
            <div class="label">데모 흐름</div>
            <div class="scenario-step">
              <div class="scenario-step-number">1</div>
              <div class="scenario-step-text">
                상품 등록 화면에서 제품 코드 입력 시,
                <span class="code">GET /api/products/autocomplete?q=...</span> 로
                <span class="code">StandardProduct</span>를 자동완성합니다.
              </div>
            </div>
            <div class="scenario-step">
              <div class="scenario-step-number">2</div>
              <div class="scenario-step-text">
                선택된 SKU의 <span class="code">std_id</span>가
                <span class="code">Item</span>에 FK로 저장됩니다.
              </div>
            </div>
            <div class="scenario-step">
              <div class="scenario-step-number">3</div>
              <div class="scenario-step-text">
                통합 검색 시
                <span class="code"
                  >Item.title OR StandardProduct.model_name</span
                >
                를 동시에 LIKE 검색합니다.
              </div>
            </div>
          </div>
        </section>

        <!-- 5. 시나리오 B: 티켓 & 암표 방지 -->
        <section id="scenario-ticket" class="section">
          <h1>5. 시나리오 B: 티켓 등록 · 암표 방지</h1>
          <p>
            <strong>목적:</strong> 티켓 특수화 테이블과 가격 제한 트리거를 통해
            데이터베이스가 비즈니스 규칙을 직접 보장하는 모습을 확인합니다.
          </p>

          <div class="card">
            <div class="label">데모 흐름</div>
            <div class="scenario-step">
              <div class="scenario-step-number">1</div>
              <div class="scenario-step-text">
                티켓 등록 시,
                <span class="code">Item</span>과
                <span class="code">TicketDetails</span>를 하나의 트랜잭션으로
                INSERT 합니다.
              </div>
            </div>
            <div class="scenario-step">
              <div class="scenario-step-number">2</div>
              <div class="scenario-step-text">
                <span class="code"
                  >Item.price ≤ TicketDetails.original_price * 1.2</span
                >
                조건을 트리거 함수에서 검사합니다.
              </div>
            </div>
            <div class="scenario-step">
              <div class="scenario-step-number">3</div>
              <div class="scenario-step-text">
                조건을 초과하는 경우 트리거가 예외를 발생시키고, INSERT 전체가
                롤백됩니다.
              </div>
            </div>
          </div>
        </section>

        <!-- 6. 시나리오 C: 카테고리 필터 -->
        <section id="scenario-category" class="section">
          <h1>6. 시나리오 C: 카테고리 필터 (재귀 쿼리)</h1>
          <p>
            <strong>목적:</strong> 계층형 카테고리를 Recursive CTE로 처리하는
            패턴을 보여줍니다.
          </p>

          <div class="card">
            <div class="label">핵심 아이디어</div>
            <ul>
              <li>카테고리 테이블은 self-join 구조</li>
              <li>
                선택한 루트 카테고리에서 시작해 모든 자식 카테고리를
                <span class="code">WITH RECURSIVE</span> 로 한 번에 조회
              </li>
              <li>조회된 전체 ID 집합을 기반으로 Item을 필터링</li>
            </ul>
          </div>
        </section>

        <!-- 7. 시나리오 D: 좌석(JSONB) 필터 -->
        <section id="scenario-seat" class="section">
          <h1>7. 시나리오 D: 좌석(JSONB) 필터</h1>
          <p>
            <strong>목적:</strong> 좌석 정보가 JSONB로 저장되어 있기 때문에
            가능한 세밀한 필터링을 보여줍니다.
          </p>

          <div class="card">
            <div class="label">핵심 아이디어</div>
            <ul>
              <li>좌석 정보는 <span class="code">TicketDetails.seat_info</span> JSONB에 저장</li>
              <li>
                예) <span class="code"
                  >{"grade":"R","sector":"A","row":10,"number":5}</span
                >
              </li>
              <li>
                필터링 시
                <span class="code"
                  >td.seat_info -&gt;&gt; 'sector' = 'A'</span
                >
                와 같이 JSON 필드에 직접 조건을 적용
              </li>
            </ul>
          </div>
        </section>
      </main>
    </div>

    <script>
      const buttons = document.querySelectorAll("nav button");
      const sections = document.querySelectorAll(".section");

      buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const targetId = btn.getAttribute("data-target");

          buttons.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          sections.forEach((sec) => {
            if (sec.id === targetId) {
              sec.classList.add("active");
            } else {
              sec.classList.remove("active");
            }
          });
        });
      });
    </script>
  </body>
  </html>


